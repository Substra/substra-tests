steps:
- name: 'gcr.io/cloud-builders/git'
  args: ['clone', 'https://github.com/SubstraFoundation/substra-backend.git', '--depth', '1', '--branch', '${_BRANCH}']
- name: 'gcr.io/kaniko-project/executor@sha256:2b939d14004ad1f299a809cbccf59ec95bef86184bc16d663eb8f30cebcbfc78'
  args:
  - --destination=eu.gcr.io/$PROJECT_ID/substra-backend:ci-${_COMMIT}
  - --cache=true
  - --dockerfile=substra-backend/docker/substra-backend/Dockerfile
  - --context=substra-backend
  - --cache-ttl=${_KANIKO_CACHE_TTL}
tags:
- ${_BUILD_TAG}
substitutions:
    _BUILD_TAG: "substra-tests"
    _COMMIT: "HEAD"
    _BRANCH: "master"
    _KANIKO_CACHE_TTL: "168h"
timeout: 1200s
